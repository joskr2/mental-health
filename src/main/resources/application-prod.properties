# ============================================
# PERFIL: PRODUCCIÓN (prod)
# ============================================
# Activar con: SPRING_PROFILES_ACTIVE=prod
# O en docker-compose: profiles: [prod]
# ============================================

# === Base de Datos - PostgreSQL ===
spring.r2dbc.url=${SPRING_R2DBC_URL:r2dbc:postgresql://postgres:5432/mental_clinic}
spring.r2dbc.username=${SPRING_R2DBC_USERNAME}
spring.r2dbc.password=${SPRING_R2DBC_PASSWORD}

# Inicialización de esquema (solo primera vez, luego usar migraciones)
spring.sql.init.mode=always
spring.sql.init.platform=postgresql

# === Pool de Conexiones R2DBC ===
spring.r2dbc.pool.enabled=true
spring.r2dbc.pool.initial-size=5
spring.r2dbc.pool.max-size=20
spring.r2dbc.pool.max-idle-time=30m
spring.r2dbc.pool.validation-query=SELECT 1

# === Logging - Mínimo para producción ===
# IMPORTANTE: Mantener security en ERROR para evitar loguear headers sensibles (tokens, auth)
logging.level.root=WARN
logging.level.com.clinica.mentalhealth=INFO
logging.level.org.springframework.r2dbc=WARN
logging.level.org.springframework.security=ERROR

# Formato JSON para logs (mejor para agregadores)
# logging.pattern.console={"timestamp":"%d{yyyy-MM-dd HH:mm:ss.SSS}","level":"%level","logger":"%logger{36}","message":"%msg"}%n

# === OpenAPI/Swagger - Deshabilitado en producción ===
springdoc.api-docs.enabled=false
springdoc.swagger-ui.enabled=false

# === Actuator - Solo health y métricas esenciales ===
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoint.health.show-details=when_authorized
management.endpoint.health.probes.enabled=true
management.health.livenessstate.enabled=true
management.health.readinessstate.enabled=true

# === Servidor - Errores seguros ===
server.error.include-message=never
server.error.include-stacktrace=never
server.error.include-binding-errors=never

# === Cache - Optimizado para producción ===
spring.cache.caffeine.spec=maximumSize=1000,expireAfterWrite=60m

# === Seguridad JWT (desde variables de entorno) ===
# jwt.secret=${JWT_SECRET}
# jwt.expiration=${JWT_EXPIRATION:86400000}
