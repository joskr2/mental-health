# ============================================
# CONFIGURACION BASE - Mental Health Clinic API
# ============================================
# Este archivo contiene la configuración compartida.
# Los perfiles específicos (dev, prod) sobrescriben
# estas propiedades según el entorno.
#
# Perfiles disponibles:
#   - dev:  PostgreSQL + logs debug + Swagger
#   - prod: PostgreSQL + logs mínimos + optimizado
#
# Activar perfil: SPRING_PROFILES_ACTIVE=dev
# ============================================

# === Flyway Database Migrations ===
# Flyway usa JDBC (no R2DBC) para ejecutar migraciones
spring.flyway.enabled=true
spring.flyway.baseline-on-migrate=true
spring.flyway.locations=classpath:db/migration
spring.flyway.url=${SPRING_FLYWAY_URL:jdbc:postgresql://localhost:5432/mental_clinic}
spring.flyway.user=${SPRING_R2DBC_USERNAME:clinic_user}
spring.flyway.password=${SPRING_R2DBC_PASSWORD:clinic_secret_2024}
# No validar migraciones en desarrollo (permite modificar V1, V2, etc.)
spring.flyway.validate-on-migrate=${FLYWAY_VALIDATE:false}

# === Información de la Aplicación ===
spring.application.name=mental-clinic-api

# === Perfil por defecto ===
spring.profiles.active=${SPRING_PROFILES_ACTIVE:dev}

# === Cache - Caffeine ===
spring.cache.type=caffeine
spring.cache.caffeine.spec=maximumSize=500,expireAfterWrite=30m

# === OpenAPI - Configuración base ===
# Springdoc deshabilitado - usamos spec estático en /static/openapi.json
# Esto evita problemas de rendimiento al generar el spec dinámicamente en WebFlux
springdoc.api-docs.enabled=false
springdoc.swagger-ui.enabled=false

# === Actuator - Configuración base ===
management.endpoint.caches.access=unrestricted

# === Servidor ===
server.port=${APP_PORT:8080}

# === IA - Asistente Administrativo (DeepSeek via OpenAI Driver) ===
# El asistente SOLO maneja tareas administrativas (citas, horarios, búsquedas)
# NO proporciona consultas clínicas ni psicológicas
spring.ai.openai.api-key=${DEEPSEEK_API_KEY:}
spring.ai.openai.base-url=https://api.deepseek.com
spring.ai.openai.chat.options.model=deepseek-chat
spring.ai.openai.chat.options.temperature=0.3
spring.ai.openai.chat.options.max-tokens=2000

# === Seguridad de Refresh Tokens ===
# Número máximo de sesiones activas por usuario (0 = sin límite)
security.refresh-token.max-sessions=5

# === Rate Limiting ===
# Configuración de límites por tipo de endpoint
rate-limit.auth.requests-per-minute=10
rate-limit.ai.requests-per-minute=20
rate-limit.general.requests-per-minute=100

# === JWT Configuration ===
# IMPORTANTE: En producción, usar variables de entorno o secrets manager
# Los valores por defecto son SOLO para desarrollo local
jwt.access-secret=${JWT_ACCESS_SECRET:development-access-secret-key-min-32-chars!!}
jwt.refresh-secret=${JWT_REFRESH_SECRET:development-refresh-secret-key-min-32-chars!}
jwt.access-expiration=${JWT_ACCESS_EXPIRATION:PT30M}
jwt.refresh-expiration=${JWT_REFRESH_EXPIRATION:P14D}
